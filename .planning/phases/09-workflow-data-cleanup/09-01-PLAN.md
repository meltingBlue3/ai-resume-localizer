---
phase: 09-workflow-data-cleanup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - workflow/resume_extraction.yml
  - workflow/resume_translation.yml
  - backend/app/models/resume.py
  - frontend/src/types/resume.ts
autonomous: true
requirements: [EXTR-01, EXTR-02, TRAN-01]

must_haves:
  truths:
    - "Extraction workflow JSON schema includes an `other` field for miscellaneous resume info (hobbies, self-PR, etc.)"
    - "Extraction workflow prompt instructs language certifications (JLPT, HSK, TOEIC, CET-4/6) to be placed in `certifications` array, not `languages`"
    - "Translation workflow JSON schema no longer contains `linkedin`, `website`, `gpa`, or `notes` fields"
    - "Backend Pydantic models match the updated workflow schemas"
    - "Frontend TypeScript interfaces match the updated Pydantic models"
  artifacts:
    - path: "workflow/resume_extraction.yml"
      provides: "Updated extraction prompt with `other` field and language cert consolidation rule"
      contains: "other"
    - path: "workflow/resume_translation.yml"
      provides: "Updated translation prompt without linkedin/website/gpa/notes"
    - path: "backend/app/models/resume.py"
      provides: "Updated Pydantic models (CnResumeData.other, no Jp linkedin/website/gpa/notes)"
      contains: "other"
    - path: "frontend/src/types/resume.ts"
      provides: "Updated TypeScript interfaces mirroring Pydantic models"
  key_links:
    - from: "workflow/resume_extraction.yml"
      to: "backend/app/models/resume.py"
      via: "JSON schema field names must match Pydantic field names"
      pattern: "other.*str.*None"
    - from: "workflow/resume_translation.yml"
      to: "backend/app/models/resume.py"
      via: "JSON schema field names must match Pydantic field names"
    - from: "backend/app/models/resume.py"
      to: "frontend/src/types/resume.ts"
      via: "TypeScript interfaces mirror Pydantic models"
---

<objective>
Update Dify workflow prompts and data models to clean up field structures: add `other` field to extraction, consolidate language certifications into `certifications`, and remove unused fields from translation output.

Purpose: Ensure workflow outputs match what templates actually need, eliminating dead fields and adding missing ones.
Output: Updated workflow YMLs, backend Pydantic models, and frontend TypeScript interfaces with clean field structures.
</objective>

<execution_context>
@C:/Users/zhang/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/zhang/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@workflow/DESIGN_PRINCIPLES.md
@workflow/resume_extraction.yml
@workflow/resume_translation.yml
@backend/app/models/resume.py
@frontend/src/types/resume.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update extraction workflow prompt — add `other` field, consolidate language certs</name>
  <files>workflow/resume_extraction.yml</files>
  <action>
In the LLM extraction node prompt (node 1740000000002), make these changes to the JSON schema section:

1. **Replace `hobbies` field with `other` field:**
   - Remove: `"hobbies": "兴趣爱好"`
   - Add: `"other": "その他の情報。趣味、自己PR、志望動機以外の補足情報など、他のフィールドに該当しない内容をまとめて記載"`
   - This captures hobbies plus any miscellaneous resume content (self-PR snippets, interests, volunteer work, etc.) that doesn't fit structured fields.

2. **Update extraction rule 7 to explicitly include language certifications:**
   - Current rule 7 mentions CET-4, CET-6, JLPT as examples.
   - Expand to: "如果在简历任意位置发现公认的语言能力证书（如 CET-4、CET-6、JLPT N1-N5、HSK、TOEIC、TOEFL、IELTS 等），必须提取到 certifications 中，即使它们出现在\"语言能力\"段落下。languages 字段仅用于记录语言名称和口语能力描述（如\"普通话\"、\"英语 流利\"），不包含具体考试成绩和证书。"

3. **Follow DESIGN_PRINCIPLES.md:** All prompt changes use constraint-style language. No CoT leakage. The `other` field instruction says what to include, not how to generate content.

IMPORTANT: When editing the YML, the prompt text is inside a YAML string with escaped newlines (`\n\`). Preserve the exact YAML formatting conventions used in the existing file. The LLM prompt text uses backslash-newline continuation.
  </action>
  <verify>
Read the updated workflow/resume_extraction.yml and confirm:
- The JSON schema section contains `"other"` field and does NOT contain `"hobbies"`
- Rule 7 explicitly lists JLPT, HSK, TOEIC, TOEFL, IELTS and clarifies `languages` vs `certifications` distinction
- YAML is valid (no syntax errors in the string escaping)
  </verify>
  <done>Extraction workflow prompt includes `other` field and explicit language certification consolidation rule. No `hobbies` field in schema.</done>
</task>

<task type="auto">
  <name>Task 2: Update translation workflow prompt — remove unused fields</name>
  <files>workflow/resume_translation.yml</files>
  <action>
In the LLM translation node prompt (node 1740100000002), make these changes to the output JSON schema section:

1. **Remove `linkedin` and `website` from `personal_info` object:**
   - Delete the lines: `"linkedin": null,` and `"website": null`

2. **Remove `gpa` and `notes` from `education` array item:**
   - Delete the lines: `"gpa": null,` and `"notes": null`

3. **Update the input format section** to note that `hobbies` has been replaced by `other` in CnResumeData:
   - Change `awards[], hobbies` to `awards[], other`

4. **Update the structure conversion rules:**
   - Change `awards + hobbies + languages → other` to `awards + other（その他情報） + languages → other`

5. **Follow DESIGN_PRINCIPLES.md:** Constraint-style prompts only. No content addition instructions.

IMPORTANT: Preserve YAML string formatting conventions (backslash-newline continuation, proper escaping).
  </action>
  <verify>
Read the updated workflow/resume_translation.yml and confirm:
- `personal_info` section has no `linkedin` or `website` fields
- `education` section has no `gpa` or `notes` fields
- Input format references `other` instead of `hobbies`
- Structure conversion rules reference `other` instead of `hobbies`
- YAML is valid
  </verify>
  <done>Translation workflow prompt no longer outputs linkedin, website, gpa, or notes fields. Input/output schemas updated for hobbies→other rename.</done>
</task>

<task type="auto">
  <name>Task 3: Update backend Pydantic models and frontend TypeScript interfaces</name>
  <files>backend/app/models/resume.py, frontend/src/types/resume.ts</files>
  <action>
**Backend (`backend/app/models/resume.py`):**

1. In `CnResumeData`, rename `hobbies` to `other`:
   - Change: `hobbies: str | None = None` → `other: str | None = None`
   - Update the comment if there is one (currently in "Content" section)

2. In `JpPersonalInfo`, remove `linkedin` and `website` fields:
   - Delete: `linkedin: str | None = None`
   - Delete: `website: str | None = None`

3. In `JpEducationEntry`, remove `gpa` and `notes` fields:
   - Delete: `gpa: str | None = None`
   - Delete: `notes: str | None = None`

**Frontend (`frontend/src/types/resume.ts`):**

4. In `CnResumeData` interface, rename `hobbies` to `other`:
   - Change: `hobbies: string | null;` → `other: string | null;`

5. In `JpPersonalInfo` interface, remove `linkedin` and `website`:
   - Delete: `linkedin?: string | null;`
   - Delete: `website?: string | null;`

6. In `JpEducationEntry` interface, remove `gpa` and `notes`:
   - Delete: `gpa?: string | null;`
   - Delete: `notes?: string | null;`
  </action>
  <verify>
- Read `backend/app/models/resume.py` and confirm: CnResumeData has `other` (no `hobbies`), JpPersonalInfo has no `linkedin`/`website`, JpEducationEntry has no `gpa`/`notes`
- Read `frontend/src/types/resume.ts` and confirm same changes mirrored
- Run: `cd backend && python -c "from app.models.resume import CnResumeData, JpResumeData; print('Models OK')"` to verify no import errors
  </verify>
  <done>Backend Pydantic models and frontend TypeScript interfaces updated: hobbies→other, linkedin/website/gpa/notes removed from Jp models.</done>
</task>

</tasks>

<verification>
1. All four files modified with consistent field changes
2. Extraction YML: has `other`, no `hobbies`, language cert rule expanded
3. Translation YML: no `linkedin`, `website`, `gpa`, `notes` in output schema
4. Backend models: `CnResumeData.other` exists, Jp models cleaned
5. Frontend types: mirror backend exactly
6. No broken imports in backend Python models
</verification>

<success_criteria>
- Extraction workflow schema includes `other` field and language cert consolidation rule
- Translation workflow schema excludes `linkedin`, `website`, `gpa`, `notes`
- Backend and frontend data models are in sync with workflow schemas
- All changes follow DESIGN_PRINCIPLES.md conventions
</success_criteria>

<output>
After completion, create `.planning/phases/09-workflow-data-cleanup/09-01-SUMMARY.md`
</output>
