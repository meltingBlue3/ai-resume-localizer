---
phase: 10-work-project-separation
plan: 02
type: execute
wave: 2
depends_on: [10-01]
files_modified:
  - backend/app/templates/shokumukeirekisho.html
autonomous: true
requirements: [RKTPL-04, SKTPL-01]

must_haves:
  truths:
    - "Shokumukeirekisho renders company-internal projects within each company block"
    - "Shokumukeirekisho has a separate section for personal/side projects"
    - "Rirekisho shows only company names and dates in work history (no project details)"
  artifacts:
    - path: "backend/app/templates/shokumukeirekisho.html"
      provides: "Updated template with project sections"
      contains: "参画プロジェクト"
    - path: "backend/app/templates/shokumukeirekisho.html"
      provides: "Personal projects section"
      pattern: "個人プロジェクト"
  key_links:
    - from: "shokumukeirekisho.html work_history loop"
      to: "job.projects"
      via: "Jinja2 conditional"
      pattern: "{% if job.projects %}"
    - from: "shokumukeirekisho.html"
      to: "data.projects"
      via: "new section"
      pattern: "{% if data.projects %}"
---

<objective>
Update shokumukeirekisho.html template to render company-internal and personal projects in appropriate sections

Purpose: Fulfill SKTPL-01 requirement - display projects correctly in 職務経歴書
Output: Updated template with project rendering logic
</objective>

<execution_context>
@C:/Users/zhang/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/zhang/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-work-project-separation/10-RESEARCH.md
@.planning/phases/10-work-project-separation/10-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add company-internal projects rendering to work history blocks</name>
  <files>backend/app/templates/shokumukeirekisho.html</files>
  <action>
Update the work_history loop in shokumukeirekisho.html to render internal projects within each company block.

**Current structure (lines ~186-219):**
```html
{% for job in data.work_history %}
<!-- Company block -->
<table class="title-table">
    <tr class="company-header-row">
        <td>{{ job.company | default('未記入') }}　（{{ job.start_date | default('') }}〜{{ job.end_date | default('現在') }}）</td>
    </tr>
</table>

{% if job.responsibilities %}
<!-- responsibilities section -->
{% endif %}

{% if job.achievements %}
<!-- achievements section -->
{% endif %}
{% endfor %}
```

**Add after achievements block, before endfor:**
```html
{% if job.projects %}
<table class="title-table">
    <tr>
        <td class="subsection-label">【参画プロジェクト】</td>
    </tr>
</table>
{% for project in job.projects %}
<table class="title-table">
    <tr class="work-detail-row">
        <td>
            <strong>{{ project.name | default('') }}</strong>
            {% if project.role %}（{{ project.role }}）{% endif %}
            {% if project.start_date %}　{{ project.start_date }}{% if project.end_date %}〜{{ project.end_date }}{% else %}〜現在{% endif %}{% endif %}
        </td>
    </tr>
</table>
{% if project.description %}
<table class="title-table">
    <tr class="bullet-row"><td>　{{ project.description }}</td></tr>
</table>
{% endif %}
{% if project.technologies %}
<table class="title-table">
    <tr class="bullet-row"><td>　使用技術：{{ project.technologies | join('、') }}</td></tr>
</table>
{% endif %}
{% endfor %}
{% endif %}
```

**Placement:** Insert this block AFTER the `{% if job.achievements %}...{% endif %}` block and BEFORE the `{% endfor %}` that closes the work_history loop.
</action>
  <verify>grep -c "参画プロジェクト" backend/app/templates/shokumukeirekisho.html && grep -c "job.projects" backend/app/templates/shokumukeirekisho.html</verify>
  <done>Template renders company-internal projects within work history blocks with name, role, dates, description, and technologies</done>
</task>

<task type="auto">
  <name>Task 2: Add personal projects section after work history</name>
  <files>backend/app/templates/shokumukeirekisho.html</files>
  <action>
Add a new section for personal/side projects after the work history loop, before the skills section.

**Find the location:** After `{% endfor %}` that closes work_history loop (around line 219), BEFORE the skills section (`<!-- ===== 活かせる経験・知識・技術 -->`).

**Insert new section:**
```html
<!-- ===== 個人プロジェクト (Personal Projects) ===== -->
{% if data.projects %}
<table class="title-table">
    <tr class="section-title-row">
        <td><span class="section-title">個人プロジェクト</span></td>
    </tr>
</table>
{% for project in data.projects %}
<table class="title-table">
    <tr class="company-header-row">
        <td>
            <strong>{{ project.name | default('未記入') }}</strong>
            {% if project.role %}（{{ project.role }}）{% endif %}
            {% if project.start_date %}　{{ project.start_date }}{% if project.end_date %}〜{{ project.end_date }}{% else %}〜現在{% endif %}{% endif %}
        </td>
    </tr>
</table>
{% if project.description %}
<table class="title-table">
    <tr class="bullet-row"><td>　{{ project.description }}</td></tr>
</table>
{% endif %}
{% if project.technologies %}
<table class="title-table">
    <tr class="bullet-row"><td>　使用技術：{{ project.technologies | join('、') }}</td></tr>
</table>
{% endif %}
{% endfor %}
{% endif %}
```

**Placement:** After the work history `{% endfor %}` (line ~219), before `<!-- ===== 活かせる経験・知識・技術 -->` (around line 221).
</action>
  <verify>grep -c "個人プロジェクト" backend/app/templates/shokumukeirekisho.html && grep -c "data.projects" backend/app/templates/shokumukeirekisho.html</verify>
  <done>Template has personal projects section that renders when data.projects exists</done>
</task>

<task type="auto">
  <name>Task 3: Verify rirekisho.html doesn't show project details</name>
  <files>backend/app/templates/rirekisho.html</files>
  <action>
Verify rirekisho.html correctly shows only company names and dates, no project details.

**What to check:**
1. Work history section uses `data.work_history_processed` (not `data.projects`)
2. Each work entry shows: company name, 入社 row, 退社/現在 row
3. No references to project details, responsibilities, or achievements

**Expected behavior (already implemented):**
- Lines 294-310: Work history uses `work_history_processed` with company/date only
- No project rendering needed - rirekisho is a simple employment history

**Verification approach:**
1. Grep for any references to `projects` in rirekisho.html - should find none
2. Confirm work_history section only renders company/date

If any issues found, fix them. Otherwise, document that no changes are needed.
</action>
  <verify>grep -c "projects" backend/app/templates/rirekisho.html; echo "Should be 0"</verify>
  <done>Rirekisho confirmed to show only company names and dates in work history section</done>
</task>

</tasks>

<verification>
1. shokumukeirekisho.html renders company-internal projects within work blocks
2. shokumukeirekisho.html has personal projects section
3. rirekisho.html shows no project details (company/date only)
4. Jinja2 syntax is valid (no unclosed tags)
</verification>

<success_criteria>
- Shokumukeirekisho displays 参画プロジェクト within company blocks when job.projects exists
- Shokumukeirekisho displays 個人プロジェクト section when data.projects exists
- Rirekisho work history shows only company names and dates
- Templates render without Jinja2 errors
</success_criteria>

<output>
After completion, create `.planning/phases/10-work-project-separation/10-02-SUMMARY.md`
</output>
